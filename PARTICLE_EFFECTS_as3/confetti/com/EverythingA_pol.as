package com {			import pointroll.*;	import pointroll.panel.*;	import pointroll.info.getCurrentDomain;	import com.pointroll.api.error.PointRollError;	import com.pointroll.api.utils.net.*	import com.greensock.*	import com.greensock.easing.*;	import com.greensock.plugins.*;	import flash.geom.Matrix;	import flash.geom.ColorTransform;	import flash.display.*;	import flash.net.*;	import flash.events.*;	import flash.system.Security;	import flash.text.*;	//	-QUICK START GUIDE:	//	-This file is shared between all 3 sizes of the ---'Everything A'--- creative.	//	-There is a small amount of AS on the stage that is size-specific for the animation. 	//	-The end frame 'offerRender.swf' is shared between all other versions (AllNew, Improvement, Reliability) and handles all sizes.	//	-'offerRender.swf' handles the details of the offers. It does NOT the handle 'NEW COROLLA' copy on the endframe for APR, APRCASH, and CASH.	public class EverythingA_pol extends MovieClip {				private var vehObj:Object = new Object();		private var c1:Confetti		private var xmlLoader: URLLoader = new URLLoader();		private var offer_mc:MovieClip;		private var offerXML:XML;				public function EverythingA_pol() {			addEventListener(Event.ADDED_TO_STAGE, init)		}				private function init(e):void{			removeEventListener(Event.ADDED_TO_STAGE, init);			btnLegal.addEventListener(MouseEvent.CLICK, legalBtnHandler);			legalMC.btnLegalClose.addEventListener(MouseEvent.CLICK, legalBtnHandler);			cta1.addEventListener(MouseEvent.CLICK, clickHandler);			cta2.addEventListener(MouseEvent.CLICK, clickHandler);			cta1.addEventListener(MouseEvent.ROLL_OVER, rollOverHandler);			cta2.addEventListener(MouseEvent.ROLL_OVER, rollOverHandler);			cta1.addEventListener(MouseEvent.ROLL_OUT, rollOutHandler);			cta2.addEventListener(MouseEvent.ROLL_OUT, rollOutHandler);			genClick.addEventListener(MouseEvent.CLICK, clickHandler);						btnLegal.buttonMode = true;			legalMC.btnLegalClose.buttonMode = true;			genClick.buttonMode = true;			cta1.buttonMode = true;			cta1.mouseChildren = false;			cta2.buttonMode = true;			cta2.mouseChildren = false;			pointroll.initAd(this);						//vehObj.MY14CorollaCTA1 = "placeholder 1"			//vehObj.MY14CorollaCTA2 = "placeholder 2"			vehObj.stateLoc = "texas"; 						//vehObj.PRAdSize // on stage AS			vehObj.vehModel ="corolla";//"tundra"// 			vehObj.vehYear = "2015";			vehObj.campaign = vehObj.vehModel + vehObj.vehYear;						//------------- AP flash vars			if(isLocal()){				vehObj.prOfferPath =  pointroll.info.getFolderPath() + "offerRender.swf";				vehObj.creativeURL =  pointroll.info.getFolderPath() + "_assets/";				vehObj.OfferType = "apr"//"cash";//    "aprcash"// "lease";//				vehObj.trim = "Blue_S";//"Red_LE"//						}else{				vehObj.creativeURL =  pointroll.getFlashVar("SharedFilePath") || pointroll.info.getFolderPath(); //870135 - MY14Corolla_POL_shared_files				vehObj.prOfferPath =  pointroll.getFlashVar("OfferFilePath") || pointroll.info.getFolderPath() + "offerRender.swf"				vehObj.trim = pointroll.getFlashVar("Color_Trim") || "Blue_S" //"Red_LE"//				vehObj.OfferType = pointroll.getFlashVar("OfferType")  || "evergreen" ;							}			prepareTextFields(); // on stage AS			loadOffer();					}//init					private function loadOffer() {			trace("\\\\  Service: \n \t http://smq.pointroll.com/clients/toyota/offers/get.aspx?Model="+vehObj.vehModel+"&year="+vehObj.vehYear+"&Offertype="+vehObj.OfferType+"&State="+vehObj.stateLoc)			xmlLoader.load(new URLRequest(returnHttpProtocol("http://smq.pointroll.com/clients/toyota/offers/get.aspx?Model="+vehObj.vehModel+"&year="+vehObj.vehYear+"&Offertype="+vehObj.OfferType+"&State="+vehObj.stateLoc)));			xmlLoader.addEventListener(Event.COMPLETE, processXML);			xmlLoader.addEventListener(IOErrorEvent.IO_ERROR, xmlLoadError);		}				private function processXML(e:Event):void{			offerXML= new XML(e.target.data);						if(offerXML.status == 0){				legalMC.scroller.content_mc.legal.text = "*"+offerXML.offers.offer.contentbody.disclaimer;				if( legalMC.scroller.content_mc.legal.height > legalMC.scroller.mask_mc.height ){					legalMC.scroller.scrollBar_mc.visible = true;				}else{					legalMC.scroller.scrollBar_mc.visible = false;				}			}else{				trace("Feed returned no data")								setUpEvergreen();			}			loadImages();				}//processXML		private function xmlLoadError(e):void{			trace(e)			setUpEvergreen();			loadImages();		}				private function loadImages():void{			imageLoader(vehObj.creativeURL + "corolla2014_"+vehObj.PRAdSize+"_EverythingA_frame1_bkg.jpg", main.frame1.vehBkg)//MCs are already on the stage ("FRAMES" layer)			imageLoader(vehObj.creativeURL + "corolla2014_"+vehObj.PRAdSize+"_EverythingA_frame2_bkg.jpg", main.frame2.vehBkg);			imageLoader(vehObj.creativeURL + "corolla2014_"+vehObj.PRAdSize+"_EverythingA_frame3_bkg.jpg", main.frame3.vehBkg);			imageLoader(vehObj.creativeURL + "corolla2014_"+vehObj.PRAdSize+"_EverythingA_frame4_bkg.jpg", main.frame4.vehBkg);			imageLoader(vehObj.creativeURL + "corolla2014_"+vehObj.PRAdSize+"_EverythingA_frame5_bkg.jpg", main.frame5.vehBkg);			imageLoader(vehObj.creativeURL + "corolla2014_"+vehObj.PRAdSize+"_default_bkg.jpg", main.frame6.vehBkg);						if( vehObj.trim == "Blue_S" ){				imageLoader(vehObj.creativeURL + "corolla2014_S_BlueCrushMetallic_"+vehObj.PRAdSize+".png", main.frame6.extraBkg);			}else if( vehObj.trim == "Red_LE" ){				imageLoader(vehObj.creativeURL + "corolla2014_S_BarcelonaRedMetallic_"+vehObj.PRAdSize+".png", main.frame6.extraBkg);							}else{				trace("missing vehicle image");							}					}//loadImages		private function imageLoader( _URL:String, _dest:MovieClip ):void{			var imageURL:String = _URL;			var image:Loader = new Loader();			image.contentLoaderInfo.addEventListener(Event.COMPLETE, imgComplete);			image.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR, imgLoadError);			image.load( new URLRequest(returnHttpProtocol(imageURL)) );						function imgComplete():void{ 				_dest.addChild(image);				//trace(imageURL)				if(_dest == main.frame1.vehBkg)   loadOfferSWF();  			}		}//imageLoader				private function imgLoadError(e:IOErrorEvent):void{			trace(e.target,"missing image");			closePolite()		}				private function loadOfferSWF():void{			//trace("LOAD OFF SWF")					var urlReq:URLRequest = new URLRequest(returnHttpProtocol(vehObj.prOfferPath));					var offerLoader:Loader = new Loader();					offerLoader.contentLoaderInfo.addEventListener(Event.COMPLETE, offerHandler);					offerLoader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR, offerFail);					offerLoader.load(urlReq);		}				private function offerHandler(e:Event):void{			offer_mc = LoaderInfo(e.target).content as MovieClip;//this is offerRender.swf			//xmlResults(finalOffer:XML, offerType:String, _model:String = "corolla", adSize:String = "160x600")						if(vehObj.OfferType.toUpperCase() == "CASH" || vehObj.OfferType.toUpperCase() == "APR" || vehObj.OfferType.toUpperCase() == "APRCASH" || vehObj.OfferType.toUpperCase() == "LEASE"){								//-------use to test 'aprcash' using the 'apr' offer call when the aprcash returns no data ---				//offerXML.offers.offer.cashbackamount = "450" //				vehObj.OfferType = "APRCASH";									//--------------------------------------------------------------------------------------------								//pass through the loaded offerXML, offer type, model, and ad size to the offer handler ****				offer_mc.xmlResults(XML(offerXML.offers.offer), vehObj.OfferType, "corolla", vehObj.PRAdSize)								main.frame6.headline.addChild(offer_mc);			}else{				setUpEvergreen();				trace("run graceful fail / evergreen")							}						startAnimation() 					}//offerHandler				private function offerFail(e):void{			trace("missing offferRender.swf")			setUpEvergreen();			startAnimation();		}				private function startAnimation():void{			//frame 1			trace("START ANIMATION")			btnLegal.visible = false;			legalMC.visible = false;			main.frame2.alpha = 0;			main.frame3.alpha = 0;			main.frame4.alpha = 0;			main.frame5.alpha = 0;			main.frame6.alpha = 0;						TweenLite.to(fadeIn_mc, .2, {delay: .1, alpha:0});			makeConfetti();						main.frame1.vehBkg.x = -24			if(vehObj.PRAdSize == "728x90") main.frame1.vehBkg.x = -40; 						var _delay:Number = .3;			main.frame1.headline.txt1.alpha = main.frame1.headline.txt2.alpha = main.frame1.headline.txt3.alpha = main.frame1.headline.txt4.alpha = 0			main.frame2.headline.txt1.alpha = main.frame2.headline.txt2.alpha = main.frame2.headline.txt3.alpha = main.frame2.headline.txt4.alpha = 0			main.frame3.headline.txt1.alpha = main.frame3.headline.txt2.alpha = main.frame3.headline.txt3.alpha = main.frame3.headline.txt4.alpha = 0			main.frame4.headline.txt1.alpha = main.frame4.headline.txt2.alpha = main.frame4.headline.txt3.alpha = main.frame4.headline.txt4.alpha = 0			main.frame5.headline.txt1.alpha = main.frame5.headline.txt2.alpha = main.frame5.headline.txt3.alpha = main.frame5.headline.txt4.alpha = 0						_delay += .25;			TweenLite.to(main.frame1.headline.txt1, .8, {delay:_delay, alpha:1});			_delay += .75;			TweenLite.to(main.frame1.headline.txt2, .8, {delay:_delay, alpha:1});			TweenLite.delayedCall( _delay, pauseConfetti)			_delay += 3;			TweenLite.delayedCall( _delay, animateFrame2);			//TweenLite.delayedCall( _delay, animateEndFrame);// <--SHORTCUT TO END FRAME ****		}//startAnimation		private function animateFrame2():void{			var _delay:Number = 0;			TweenLite.to(main.frame2, .8, {delay:_delay, alpha:1, overwrite:false});			TweenLite.to(main.frame2.vehBkg, 3, {delay:_delay, x:-24, ease:Linear.easeNone, overwrite:false});						_delay += .75;			TweenLite.to(main.frame2.headline.txt1, .8, {delay:_delay, alpha:1});			TweenLite.to(main.frame2.headline.txt2, .8, {delay:_delay, alpha:1});			TweenLite.to(main.frame2.headline.txt3, .8, {delay:_delay, alpha:1});			_delay += 2.25;			TweenLite.delayedCall( _delay, animateFrame3);		}		private function animateFrame3():void{			var _delay:Number = 0;			TweenLite.to(main.frame3, .8, {delay:_delay, alpha:1, overwrite:false});			main.frame3.vehBkg.x = -24			TweenLite.to(main.frame3.vehBkg, 3, {delay:_delay, x:0, ease:Linear.easeNone, overwrite:false});			_delay += .75;			TweenLite.to(main.frame3.headline.txt1, .8, {delay:_delay, alpha:1});			TweenLite.to(main.frame3.headline.txt2, .8, {delay:_delay, alpha:1});			TweenLite.to(main.frame3.headline.txt3, .8, {delay:_delay, alpha:1});			_delay += 2.25;			TweenLite.delayedCall( _delay, animateFrame4);		}				private function animateFrame4():void{			var _delay:Number = 0;			TweenLite.to(main.frame4, .8, {delay:_delay, alpha:1, overwrite:false});			TweenLite.to(main.frame4.vehBkg, 3, {delay:_delay, x:-24, ease:Linear.easeNone, overwrite:false});						_delay += .75;			TweenLite.to(main.frame4.headline.txt1, .8, {delay:_delay, alpha:1});			TweenLite.to(main.frame4.headline.txt2, .8, {delay:_delay, alpha:1});			TweenLite.to(main.frame4.headline.txt3, .8, {delay:_delay, alpha:1});			_delay += 2.25;			TweenLite.delayedCall( _delay, animateFrame5);		}				private function animateFrame5():void{			var _delay:Number = 0;			TweenLite.to(main.frame5, .8, {delay:_delay, alpha:1, overwrite:false});			main.frame5.vehBkg.x = -24			TweenLite.to(main.frame5.vehBkg, 3, {delay:_delay, x:0, ease:Linear.easeNone, overwrite:false});						_delay += .75;			TweenLite.to(main.frame5.headline.txt1, .8, {delay:_delay, alpha:1});			TweenLite.to(main.frame5.headline.txt2, .8, {delay:_delay, alpha:1});			TweenLite.to(main.frame5.headline.txt3, .8, {delay:_delay, alpha:1});			_delay += 2.25;			TweenLite.delayedCall( _delay, animateEndFrame);		}				private function animateEndFrame():void{			TweenLite.to(main.frame6, .8, { alpha:1, overwrite:false});				TweenLite.from(main.frame6.headline, .5, {delay:.8, alpha:0, overwrite:false});				btnLegal.visible = true;			TweenLite.from(btnLegal, .5, {delay:.8, alpha:0, overwrite:false});						if(vehObj.OfferType.toUpperCase() == "CASH"){				TweenLite.to(main.frame6.logo_on, .5, {delay:.8, alpha:1, overwrite:false});					skewer(main.frame6.logo_on, -18, 0)				main.frame6.logo_on.rotation = -15;							}else if(vehObj.OfferType.toUpperCase() == "APR"){				TweenLite.to(main.frame6.logo, .5, {delay:.8, alpha:1, overwrite:false});					skewer(main.frame6.logo, -18, 0)				main.frame6.logo.rotation = -15;						}else if(vehObj.OfferType.toUpperCase() == "APRCASH"){				TweenLite.to(main.frame6.logo_aprcash, .5, {delay:.8, alpha:1, overwrite:false});				skewer(main.frame6.logo_aprcash, -18, 0)				main.frame6.logo_aprcash.rotation = -15;						}else if(vehObj.OfferType.toUpperCase() == "LEASE"){				//offerRender.swf handles the logo in this case. Lease versions must mention trim.							}else{				trace("GRACEFUL FAIL / EVERGREEN ENDFRAME")				btnLegal.visible = false;				main.frame6.logo_dflt.alpha = 1;				skewer(main.frame6.logo_dflt, -18, 0)				main.frame6.logo_dflt.rotation = -15;			}		}				private function makeConfetti():void{							//trace("making confetti");				if (vehObj.PRAdSize == "728x90") {					//trace("confetti here 728");					c1 = new Confetti({						width: 728,						height: 90 / 0.7,						colors: [0x003399, 0xcc0000, 0xcccc00, 0x00de00, 0x00dece],						maxPieces: 250					});				} else if (vehObj.PRAdSize == "300x250") {					//trace("confetti here 300");					c1 = new Confetti({						width: 300,						height: 250 / 0.7,						colors: [0x003399, 0xcc0000, 0xcccc00, 0x00de00, 0x00dece],						maxPieces: 650					});				} else {					//trace("confetti here 600 or other");					c1 = new Confetti({						width: 160,						height: 600 * 2,						colors: [0x003399, 0xcc0000, 0xcccc00, 0x00de00, 0x00dece],						maxPieces: 1500,						speed: 3					});				}				MovieClip(main.frame1.extraBkg.addChild(c1));				c1.start(main.frame1.extraBkg);		}//makeConfetti				private function pauseConfetti() {			try {				c1.pause();			} catch (e: Error) {				trace("NO PAUSE")			}		}//pauseConfetti				private function formatCopy( _copy:String,  _dest:TextField,  _font:String, _size:String, _color:String,  _xPos:String, _yPos:String ):void{			var newFormat:TextFormat = new TextFormat()			newFormat.font = _font;			newFormat.size = _size;			newFormat.color = _color;						_dest.htmlText = _copy;			_dest.x = Number(_xPos)			_dest.y = Number(_yPos)						_dest.antiAliasType = AntiAliasType.ADVANCED;			_dest.multiline = true;			_dest.setTextFormat(newFormat)			_dest.rotation = -15;			skewer(_dest, -18, 0)		}//formatCopy						public function skewer(target: DisplayObject, _x: Number, _y: Number): void {			var mtx: Matrix = new Matrix();			mtx.b = _y * Math.PI / 180;			mtx.c = _x * Math.PI / 180;			mtx.concat(target.transform.matrix);			target.transform.matrix = mtx;		}				private function legalBtnHandler(e:MouseEvent):void{			switch(e.currentTarget.name){								case "btnLegalClose":					legalMC.visible = false;					btnLegal.visible = true;				break;				case "btnLegal":					btnLegal.visible = false;					legalMC.visible = true;					legalMC.alpha = 0					TweenLite.to(legalMC, .4, {alpha:1});				break;			}		}				private function rollOverHandler(e: MouseEvent): void {			e.currentTarget.removeEventListener(Event.ENTER_FRAME, btnOutHandler);			e.currentTarget.addEventListener(Event.ENTER_FRAME, btnOverHandler);		}		private function rollOutHandler(e: MouseEvent): void {			e.currentTarget.removeEventListener(Event.ENTER_FRAME, btnOverHandler);			e.currentTarget.addEventListener(Event.ENTER_FRAME, btnOutHandler);		}		private function btnOverHandler(e: Event): void {			e.currentTarget.nextFrame();		}		private function btnOutHandler(e: Event): void {			e.currentTarget.prevFrame();		}				private function clickHandler(e:MouseEvent):void{			switch(e.currentTarget.name){				case "cta1":					pointroll.launchURL(pointroll.getFlashVar("clickTag1"))					trace("cta 1 - clickTag1")				break;				case "cta2":					pointroll.launchURL(pointroll.getFlashVar("clickTag2"))					trace("cta 2 - clickTag1")				break;				case "genClick":					pointroll.launchURL(pointroll.getFlashVar("clickTag3"))					trace("general - clickTag3")				break;			}		}				private function setUpEvergreen():void{				vehObj.OfferType = "evergreen" // 				btnLegal.visible = false;		}				private function closePolite():void{			pointroll.panel.closePanel();			trace("show default banner");		}	}//c	}//p