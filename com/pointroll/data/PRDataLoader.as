package com.pointroll.data{	import com.pointroll.interfaces.IPRDataProvider;	import com.pointroll.interfaces.IPRDataParser;		import flash.events.Event;	import flash.events.EventDispatcher;	import flash.events.IOErrorEvent;	import com.pointroll.events.PRParserEvents;		import flash.net.URLLoader;	import flash.net.URLRequest;	import flash.display.Sprite;	import flash.net.URLVariables;		public class PRDataLoader extends EventDispatcher implements IPRDataProvider{		private var _source:String;				private var _xml:XML;				private var _parser:IPRDataParser;				private var _xmlLoader:URLLoader;		private var _xmlVariables:URLVariables;		private var _xmlRequest:URLRequest;				public function PRDataLoader(sourceData:String, iParser:IPRDataParser = null) {			_source = sourceData;			_parser = iParser;				_xmlVariables = new URLVariables();			_xmlRequest = new URLRequest(_source);						_parser.addEventListener(PRParserEvents.ON_PARSER_COMPLETE,onDataParsed);			_parser.addEventListener("noDataFound",noDataFound);					}				public function getServiceData():void{			if(_parser){				_xmlLoader = new URLLoader();								_xmlLoader.addEventListener(Event.COMPLETE, onXMLLoadComplete);				_xmlLoader.addEventListener(IOErrorEvent.IO_ERROR, onXMLLoadFail);								 				//_xmlRequest.data = _xmlVariables; 								//trace("Loading source: " + _source + "?" + _xmlRequest.data);				trace("\n _xmlRequest: " + _xmlRequest.url);								try{					_xmlLoader.load(_xmlRequest);				}catch(e:Error){					trace("XMLLOADER ERROR: " + e);				}			}			else{				throw new Error("A Parser needs to be set before getting data.");			}					}		public function getParsedData():*{			return _parser.getParseData();		}		public function getRawServiceData():*{			return _xml;		}		public function setVariables(name:String, value:*):void{			_xmlVariables[name] = value;		}				//GETTER & SETTERS		public function set dataSource(d:*):void{			if(_source is String){				_source = d;			}			else{				throw new Error("The data source must be a string");			}					}		public function set dataParser(p:IPRDataParser):void{			_parser = p;		}		public function set xmlVars(v:URLVariables):void{			_xmlVariables = v;		}		public function get dataSource():*{			return _source;					}		public function get dataParser():IPRDataParser{			return _parser;		}		public function get xmlVars():URLVariables{			return _xmlVariables;		}				//Events		private function onXMLLoadComplete(e:Event):void{			trace("onXMLLoadComplete");			_xml = new XML(e.target.data);			_parser.parseData(_xml);		}		private function onXMLLoadFail(e:IOErrorEvent){			trace("onXMLLoadFail " + e);		}		private function onDataParsed(e:PRParserEvents):void{			dispatchEvent(new PRParserEvents(PRParserEvents.ON_PARSER_COMPLETE,e.params));		}		private function noDataFound(e:Event):void{			trace("prxmlLoader noDataFound");			dispatchEvent(new Event("noDataFound"));		}			}	}/*		function getServiceData():void;		function getParsedData()*;		function getRawServiceData()*;				function set dataSource(d:*):void;		function set dataParser(p:IDataParser):void;		function get dataSource():*;		function get dataParser():IDataParser;	*/